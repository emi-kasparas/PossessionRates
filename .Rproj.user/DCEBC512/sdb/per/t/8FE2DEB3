{
    "collab_server" : "",
    "contents" : "# old <- read.csv(\"output/cities output with id final 2015-04-16 15-49-54.csv\", stringsAsFactors=F)\n# d.new <- read.csv(\"output/cities output with id final 2015-05-19 13-24-19.csv\", stringsAsFactors=F)\n# city.codes <- read.csv(\"input/city codes id.csv\", stringsAsFactors=F)\n# city.codes <- rename(city.codes, c(CityCodeID=\"CountryCodeID\"))\n# p.codes <- read.csv(\"input/possession_codes.csv\", stringsAsFactors=F)\n# \n# setdiff.data.frame <-\n#   function(A,B) A[ !duplicated( rbind(B,A) )[ -seq_len(nrow(B))] , ]\n# \n# changed.new <- setdiff.data.frame(d.new, old)\n# changed.old <- setdiff.data.frame(old, d.new)\n# \n# changed.new$type <- \"new\"\n# changed.old$type <- \"old\"\n# \n# changed <- rbind(changed.new, changed.old)\n# \n# changed <- merge(changed, city.codes, by=c(\"CountryCodeID\"))\n# changed <- merge(changed, p.codes, by=c(\"ProductID\"))\n# \n# changed <- changed[,c(\"type\",\"CityCode\", \"CityName\", \"ProductName\", \"ProductID\", \"CountryCodeID\", paste0(\"Y\", c(2005:2030)))]\n# \n# write.csv(changed, paste0(\"output/cities changed_\", Sys.Date(),\".csv\"), row.names=F)\n\nd.new <- read.csv(\"output/cities output final 2016-06-10 00-56-45.csv\", stringsAsFactors=F)\nd.old <- read.csv(\"input/PossData2016-05-03.csv\", stringsAsFactors = F)\n\nd.new <- melt(d.new, id=c(\"CityCode\", \"CountryCode\", \"City\", \"ProductID\", \"Possession\", \"CityCodeID\"))\nd.new <- rename(d.new, c(variable=\"Year\", value=\"new\", Possession=\"ProductName\"))\nd.new$Year <- sub(\"X\", \"\", d.new$Year)\nd.new$ProductName <- NULL\n\nd.old <- d.old[,c(\"ProductID\", \"ProductName\", \"CityCode\", paste0(\"Y\", 2005:2030))]\nd.old <- melt(d.old, id=c(\"ProductID\", \"ProductName\", \"CityCode\"))\nd.old$variable <- sub(\"Y\", \"\", d.old$variable)\nd.old <- rename(d.old, c(variable=\"Year\", value=\"old\"))\n\ndata <- merge(d.new, d.old, by=c(\"ProductID\", \"CityCode\", \"Year\"))\n\ndata$diff.old.new <- abs((round(data$new,2)-round(data$old,2))/round(data$old,2)*100)\n\n##output\n\ndata.out <- melt(data, id=c(\"ProductID\", \"CityCode\", \"Year\", \"CountryCode\", \"City\",\n                            \"CityCodeID\", \"ProductName\"))\ndata.out <- dcast(data.out, ProductID+CityCode+CountryCode+City+CityCodeID+ProductName+\n                    variable~Year, value.var=\"value\")\n\nwrite.csv(data.out, paste0(\"output/Compare_old_and_new \", Sys.Date(), \".csv\"), row.names = F)\n\n\n#add totals (old and new) to data\nload(\"input/Possessions by Decile/final_poss_by_decile RData/final_poss_by_decile 2016-06-03.RData\")\ntnew <- final.pbd\n\nload(\"input/Possessions by Decile/final_poss_by_decile RData/final_poss_by_decile 2015-12-10.RData\")\ntold <- final.pbd\n\ntnew$pos <- \"new\"\ntold$pos <- \"old\"\n\ntt <- rbind(tnew, told)\ntt <- tt[,c(\"Year\", \"Decile.No\", \"CountryCode\", \"ProductID\", \"est.Pos.norm\", \"pos\")]\n\ntt <- ddply(tt, .(Year, CountryCode, ProductID, pos), summarise, t.poss=mean(est.Pos.norm))\ntt <- dcast(tt, Year+CountryCode+ProductID~pos, value.var=\"t.poss\")\n\ntt <- rename(tt, c(new=\"t.new\", old=\"t.old\"))\n\ndata <- merge(data, tt, by=c(\"Year\", \"CountryCode\", \"ProductID\"), all.x=T)\n\n\n#duomenys,kurie pasikeite daugiau nei per 10proc\nchanges <- unique(data[data$diff.old.new>10,c(\"CityCode\", \"ProductID\", \"CountryCode\", \"ProductName\", \"City\")])\n\nchanges$id <- paste0(changes$CityCode, changes$ProductID, changes$CountryCode,\n                     changes$ProductName, changes$City)\ndata$id <- paste0(data$CityCode, data$ProductID, data$CountryCode,\n                  data$ProductName, data$City)\n\ndata.diff10proc <- data[data$id %in% changes$id,]\ndata.diff10proc$id <- NULL\ndata$id <- NULL\n\n##graphs\n\ncomparing.old.new.data(data, savedir = \"plots/9. Comparing old and new/\",\n                       filename = \"Comparing old and new poss \")\n\ncomparing.old.new.data(data.diff10proc, savedir = \"plots/9. Comparing old and new/\",\n                       filename = \"Comparing old and new poss diff 10proc \")\n\n\n",
    "created" : 1463642964444.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2180411302",
    "id" : "8FE2DEB3",
    "lastKnownWriteTime" : 1465492639,
    "last_content_update" : 1465492639119,
    "path" : "C:/Users/Domantas/Desktop/justes/PossessionRates/what has been changed.R",
    "project_path" : "what has been changed.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}